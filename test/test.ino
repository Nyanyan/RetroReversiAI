#define hw 8
#define hw2 64

const double weight_s[hw2] = {
  3.2323232323232323, 0.23088023088023088, 1.3852813852813852, 1.0389610389610389, 1.0389610389610389, 1.3852813852813852, 0.23088023088023088, 3.2323232323232323,
  0.23088023088023088, 0.0, 0.9004329004329005, 0.9004329004329005, 0.9004329004329005, 0.9004329004329005, 0.0, 0.23088023088023088,
  1.3852813852813852, 0.9004329004329005, 1.0389610389610389, 0.9466089466089466, 0.9466089466089466, 1.0389610389610389, 0.9004329004329005, 1.3852813852813852,
  1.0389610389610389, 0.9004329004329005, 0.9466089466089466, 0.9235209235209235, 0.9235209235209235, 0.9466089466089466, 0.9004329004329005, 1.0389610389610389,
  1.0389610389610389, 0.9004329004329005, 0.9466089466089466, 0.9235209235209235, 0.9235209235209235, 0.9466089466089466, 0.9004329004329005, 1.0389610389610389,
  1.3852813852813852, 0.9004329004329005, 1.0389610389610389, 0.9466089466089466, 0.9466089466089466, 1.0389610389610389, 0.9004329004329005, 1.3852813852813852,
  0.23088023088023088, 0.0, 0.9004329004329005, 0.9004329004329005, 0.9004329004329005, 0.9004329004329005, 0.0, 0.23088023088023088,
  3.2323232323232323, 0.23088023088023088, 1.3852813852813852, 1.0389610389610389, 1.0389610389610389, 1.3852813852813852, 0.23088023088023088, 3.2323232323232323
};

const double weight_e[hw2] = {
  2.2153846153846155, 0.36923076923076925, 1.6, 0.9846153846153847, 0.9846153846153847, 1.6, 0.36923076923076925, 2.2153846153846155,
  0.36923076923076925, 0.0, 0.9846153846153847, 0.9846153846153847, 0.9846153846153847, 0.9846153846153847, 0.0, 0.36923076923076925,
  1.6, 0.9846153846153847, 0.9846153846153847, 0.9846153846153847, 0.9846153846153847, 0.9846153846153847, 0.9846153846153847, 1.6,
  0.9846153846153847, 0.9846153846153847, 0.9846153846153847, 0.9846153846153847, 0.9846153846153847, 0.9846153846153847, 0.9846153846153847, 0.9846153846153847,
  0.9846153846153847, 0.9846153846153847, 0.9846153846153847, 0.9846153846153847, 0.9846153846153847, 0.9846153846153847, 0.9846153846153847, 0.9846153846153847,
  1.6, 0.9846153846153847, 0.9846153846153847, 0.9846153846153847, 0.9846153846153847, 0.9846153846153847, 0.9846153846153847, 1.6,
  0.36923076923076925, 0.0, 0.9846153846153847, 0.9846153846153847, 0.9846153846153847, 0.9846153846153847, 0.0, 0.36923076923076925,
  2.2153846153846155, 0.36923076923076925, 1.6, 0.9846153846153847, 0.9846153846153847, 1.6, 0.36923076923076925, 2.2153846153846155
};

int check_mobility(int p, int o) {
  int p1 = p << 1;
  return ~(p1 | o) & (p1 + o);
}

int reverse(int a) {
  int res = 0;
  for (int i = 0; i < hw; i++) {
    res <<= 1;
    res |= 1 & (a >> i);
  }
  return res;
}

void print_board(int p[hw], int o[hw]) {
  for (int i = 0; i < hw; i++) {
    for (int j = hw - 1; j >= 0; j--) {
      if (1 & (p[i] >> j))
        Serial.print(1);
      else if (1 & (o[i] >> j))
        Serial.print(2);
      else
        Serial.print(0);
    }
    Serial.println("");
  }
  Serial.println("");
}

void setup() {
  Serial.begin(115200);
  int me[hw] = {
    0b00000000,
    0b00000000,
    0b00000000,
    0b00000000,
    0b00010000,
    0b00000000,
    0b00000000,
    0b00000000
  };
  int op[hw] = {
    0b00000000,
    0b00000000,
    0b00001000,
    0b00011000,
    0b00001000,
    0b00000000,
    0b00000000,
    0b00000000
  };
  int dammy[hw] = {0, 0, 0, 0, 0, 0, 0, 0};
  int mobility[8] = {0, 0, 0, 0, 0, 0, 0, 0};
  int mobility_tmp, p, o;
  print_board(me, op);
  for (int i = 0; i < hw; i++) {
    mobility[i] |= check_mobility(me[i], op[i]);
    mobility[i] |= reverse(check_mobility(reverse(me[i]), reverse(op[i])));
  }
  for (int i = 0; i < hw; i++) {
    p = 0;
    o = 0;
    for (int j = 0; j < hw; j++) {
      p <<= 1;
      o <<= 1;
      p |= 1 & (me[j] >> (hw - 1 - i));
      o |= 1 & (op[j] >> (hw - 1 - i));
    }
    mobility_tmp = check_mobility(p, o);
    mobility_tmp |= reverse(check_mobility(reverse(p), reverse(o)));
    for (int j = 0; j < hw; j++)
      mobility[j] |= (1 & (mobility_tmp >> (hw - 1 - j))) << (hw - 1 - i);
  }
  for (int i = 2; i < hw * 2 - 2; i++) {
    p = 0;
    o = 0;
    for (int j = 0; j < hw; j++) {
      p <<= 1;
      o <<= 1;
      if (hw - i + j < 0)
        continue;
      if (hw - i + j >= hw)
        continue;
      p |= (1 & (me[hw - i + j] >> (hw - 1 - j)));
      o |= (1 & (op[hw - i + j] >> (hw - 1 - j)));
    }
    mobility_tmp = check_mobility(p, o);
    mobility_tmp |= reverse(check_mobility(reverse(p), reverse(o)));
    for (int j = 0; j < hw; j++) {
      if (hw - i + j < 0)
        continue;
      if (hw - i + j >= hw)
        continue;
      mobility[hw - i + j] |= (1 & (mobility_tmp >> (hw - 1 - j))) << (hw - 1 - j);
    }
  }
  for (int i = 2; i < hw * 2 - 2; i++) {
    p = 0;
    o = 0;
    for (int j = 0; j < hw; j++) {
      p <<= 1;
      o <<= 1;
      if (hw - i + j < 0)
        continue;
      if (hw - i + j >= hw)
        continue;
      p |= (1 & (me[j] >> (hw - i + j)));
      o |= (1 & (op[j] >> (hw - i + j)));
    }
    mobility_tmp = check_mobility(p, o);
    mobility_tmp |= reverse(check_mobility(reverse(p), reverse(o)));
    for (int j = 0; j < hw; j++) {
      if (hw - i + j < 0)
        continue;
      if (hw - i + j >= hw)
        continue;
      mobility[hw - i + j] |= (1 & (mobility_tmp >> (hw - 1 - j))) << (hw - i + j);
    }
  }
  print_board(mobility, dammy);
}

void loop() {
  // put your main code here, to run repeatedly:

}
